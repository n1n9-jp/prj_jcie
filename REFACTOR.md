# リファクタリング計画（未完了タスクのみ）

## 優先度最高

### 1️⃣ グローバルスコープの汚染を軽減（モジュール化）
- **課題**: 43 個のグローバル変数が散在し、依存関係が暗黙的。
- **目的**: ES モジュール化と名前空間整理で競合とテスト困難を解消。
- **次の一歩**:
  - `shared/assets/js` から段階的に `import/export` へ移行。
  - エントリ HTML の `<script>` 群をバンドラ管理に切り替える。

---

## 優先度中

### 6️⃣ エラーハンドリングの統一化
- **現状**: `ErrorHandler` が一部クラスでのみ使用され、UI での通知方法も未統一。
- **実装方針**:
  - すべての Manager / Renderer で `ErrorHandler.handle` を経由。
  - 軽量な Toast もしくは Alert UI を作成し、致命的エラーのみ表示。
  - 重要ログは Logger と連携して集計。

### 7️⃣ 依存関係の最小化と読み込み最適化
- **課題**: 30 行を超える `<script>` 群と CDN 依存で順序に敏感。
- **実装方針**:
  - `esbuild` か `webpack` で共有スクリプトをバンドル。
  - `async/defer`・動的 import を組み合わせて初期描画を高速化。

### 8️⃣ ユーティリティクラスの使用率向上（Phase 2）
- **現状**: Map 系は `MapHelper` に統一済み、Chart 系ユーティリティの適用が未着手。
- **残タスク**:
  - `ChartLayoutManager`/`ChartFormatterHelper` をすべてのレンダラーで必須化。
  - 未使用のユーティリティ（存在すれば）削除または README に用途を明記。

---

## 優先度低

### 9️⃣ テスト導入と自動化
- **目的**: リグレッション検知とブラウザ差異の早期発見。
- **着手案**:
  - Jest でユーティリティ・マネージャーの単体テスト。
  - Playwright などで主要ステップの E2E テスト。
  - GitHub Actions で PR 時に自動実行。

### 🔟 TypeScript 導入
- **価値**: 型補完とリファクタ耐性の向上。
- **段階案**:
  1. `tsconfig` と `checkJs` を導入して型エラーを洗い出す。
  2. Utils → Managers → Renderers の順で `.ts` 化。
  3. ビルドは既存バンドラ（7️⃣着手時）と統合。

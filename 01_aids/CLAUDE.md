# Scrollytelling コンテンツ要件定義

## 概要
スクロールに応じてテキスト、チャート、地図が連動して表示・変化するWebコンテンツを作成する。汎用的な実装とし、テーマ特有の機能は含まない。

## 技術仕様

### 利用ライブラリ・スクリプト
- **pubsub.js**: イベント管理
- **d3.js**: データ可視化・チャート描画
- **scrollama.js**: スクロールトリガー制御
- **Tailwind CSS**: スタイリング
- **Vanilla JavaScript**: フレームワーク不使用

### 対応環境
- モダンブラウザのみ対応（IE非対応）
- レスポンシブレイアウト対応

## 機能要件

### レイアウト
- **オーバーレイ方式**: チャート・地図の上にテキストを重ねて表示
- **HTML1ファイル完結**: 外部ファイル依存を最小化
- **レスポンシブ対応**: 各デバイスサイズに対応

### データ形式
- **CSV形式**: チャートデータ
- **JSON形式**: 設定ファイル、地図データ
- **設定ファイル**: 各段落とデータの対応関係をJSONで管理

### 表示コンテンツ

#### テキスト
- **段落数**: 5〜10段落を想定
- **表示制御**: スクロール位置に応じた表示・非表示
- **位置**: 柔軟に指定可能

#### チャート
- **種類**: 折れ線グラフ、円グラフ、棒グラフ
- **表示制御**: d3.jsのtransition機能を使用
- **サイズ**: 縦・横・アスペクト比を柔軟に指定可能
- **要素**: 色、配置場所の変更対応

#### 地図
- **対象**: 世界地図および各都市フォーカス
- **アニメーション**: 画面中心の緯度経度とズームレベル変更
- **表示制御**: スムーズなトランジション

### アニメーション・トランジション
- **一定の設定**: トランジション時間・種類は統一
- **スムーズな表示切替**: チャート・地図の表示・非表示
- **d3.js活用**: transition機能によるアニメーション実装

## 設定管理
- **JSON設定ファイル**: 段落とデータの対応関係
- **柔軟な指定**: 表示位置、サイズ、色などの設定
- **データバインディング**: 各段落に対応するチャート・地図状態の定義

## 設定ファイル構造

### 基本構造（config.json）
```json
{
  "steps": [
    {
      "id": "step1",
      "text": "段落のテキスト内容",
      "chart": {
        "type": "line",
        "data": "data/chart1.csv",
        "visible": true,
        "size": { "width": 600, "height": 400 }
      },
      "map": {
        "center": [35.6762, 139.6503],
        "zoom": 10,
        "visible": false
      }
    }
  ],
  "settings": {
    "transition": { "duration": 500, "ease": "cubic-in-out" },
    "layout": { "textPosition": "left", "chartPosition": "right" }
  }
}
```

### データファイル構造
- **CSVファイル**: チャートデータ（ヘッダー行必須）
- **GeoJSONファイル**: 地図データ（標準GeoJSON形式）

## エラーハンドリング

### データ読み込み
- **Promise.all()**: 複数ファイルの並列読み込み
- **d3.csv(), d3.json()**: d3.jsの標準読み込み関数を使用
- **フォールバック**: 読み込み失敗時のデフォルト表示

### 実装例
```javascript
Promise.all([
  d3.json('config.json'),
  d3.csv('data/chart1.csv'),
  d3.json('data/world-map.json')
]).then(([config, chartData, mapData]) => {
  // 正常処理
}).catch(error => {
  console.error('データ読み込みエラー:', error);
  // エラー表示またはデフォルト状態
});
```

## 実装方針
- 汎用性を重視し、特定テーマに依存しない設計
- 設定ファイルによる柔軟なカスタマイズ対応
- パフォーマンスを考慮したスムーズなスクロール体験
- シンプルな階層構造でメンテナンス性を確保